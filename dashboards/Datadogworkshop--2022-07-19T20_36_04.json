{"title":"Datadog workshop","description":"# Basic dashbord for applications in a GKE cluster","widgets":[{"id":8716441955826606,"definition":{"type":"image","url":"https://www.sfeir.com/wp-content/uploads/2021/03/logo-miniature.jpg","sizing":"cover","has_background":true,"has_border":true,"vertical_align":"center","horizontal_align":"center"},"layout":{"x":0,"y":0,"width":2,"height":1}},{"id":5258753936839224,"definition":{"title":"Orders completed","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"search":{"query":"@http.path_group:\"/checkout/update/payment\" @http.status_code:302"},"data_source":"spans","compute":{"aggregation":"count"},"name":"query1","indexes":["trace-search"],"group_by":[]}]}],"autoscale":true,"precision":2},"layout":{"x":2,"y":0,"width":1,"height":1}},{"id":764552400543718,"definition":{"title":"","type":"manage_status","display_format":"list","color_preference":"text","hide_zero_counts":true,"query":"tag:($app)","sort":"status,asc","count":50,"start":0,"summary_type":"monitors","show_priority":false,"show_last_triggered":false},"layout":{"x":3,"y":0,"width":3,"height":3}},{"id":6422903704855496,"definition":{"title":"Sessions overview","title_align":"left","type":"group","background_color":"white","layout_type":"ordered","widgets":[{"id":3475858531539636,"definition":{"title":"Total user sessions","title_size":"16","title_align":"left","type":"query_value","requests":[{"rum_query":{"index":"*","search":{"query":"@type:session @session.type:\"user\""},"group_by":[],"compute":{"aggregation":"count"}}}],"autoscale":true,"precision":2},"layout":{"x":0,"y":0,"width":1,"height":1}},{"id":1404093618125230,"definition":{"title":"Number of sessions","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"week_before(query3)","alias":"Last Week Sessions"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"search":{"query":"@type:session @session.type:\"user\""},"data_source":"rum","compute":{"aggregation":"count"},"name":"query3","indexes":["*"],"group_by":[]}],"style":{"palette":"grey","line_type":"dotted","line_width":"normal"},"display_type":"line"},{"formulas":[{"formula":"query3","alias":"Sessions"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"search":{"query":"@type:session @session.type:\"user\""},"data_source":"rum","compute":{"aggregation":"count"},"name":"query3","indexes":["*"],"group_by":[]}],"style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":1,"y":0,"width":5,"height":3}},{"id":8243566616410552,"definition":{"title":"Average session duration","title_size":"16","title_align":"left","type":"query_value","requests":[{"rum_query":{"index":"*","search":{"query":"@type:session @session.type:\"user\""},"group_by":[],"compute":{"facet":"@session.time_spent","aggregation":"avg"}}}],"autoscale":true,"precision":2},"layout":{"x":0,"y":1,"width":1,"height":1}},{"id":6718950684841822,"definition":{"title":"Page views per session","title_size":"16","title_align":"left","type":"query_value","requests":[{"rum_query":{"index":"*","search":{"query":"@type:session @session.type:\"user\""},"group_by":[],"compute":{"facet":"@session.view.count","aggregation":"avg"}}}],"autoscale":true,"precision":2},"layout":{"x":0,"y":2,"width":1,"height":1}},{"id":2831507040508858,"definition":{"title":"Top 15 pages","show_legend":true,"legend_layout":"vertical","legend_columns":["value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Page views","formula":"query1"}],"response_format":"timeseries","queries":[{"search":{"query":"@type:view @session.type:user"},"data_source":"rum","compute":{"aggregation":"count"},"name":"query1","indexes":["*"],"group_by":[{"facet":"@view.name","sort":{"aggregation":"count","order":"desc"},"limit":15}]}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[],"custom_links":[{"link":"/rum/explorer?&tab=view","label":"Explore related views"}]},"layout":{"x":1,"y":3,"width":5,"height":3}}]},"layout":{"x":6,"y":0,"width":6,"height":7}},{"id":4866387862394,"definition":{"title":"Carts aborded","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:trace.rack.request.hits{resource_name:spree::orderscontroller_empty}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2},"layout":{"x":0,"y":1,"width":1,"height":1}},{"id":2918684412940442,"definition":{"title":"","title_size":"16","title_align":"left","type":"slo","view_type":"detail","time_windows":["7d","previous_week"],"slo_id":"dc435d63223458bb9ead4839b3f878dc","show_error_budget":true,"view_mode":"overall","global_time_target":"0"},"layout":{"x":1,"y":1,"width":2,"height":2}},{"id":214967151280844,"definition":{"title":"Coupons error","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"conditional_formats":[{"comparator":">","palette":"white_on_yellow","value":0},{"comparator":">=","palette":"white_on_green","value":0}],"response_format":"scalar","queries":[{"query":"sum:trace.rack.request.hits{resource_name:spree::api::v2::storefront::cartcontroller_apply_coupon_code,!http.status_code:200}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"area","yaxis":{"include_zero":false}}},"layout":{"x":0,"y":2,"width":1,"height":1}},{"id":5574903516806660,"definition":{"type":"note","content":"Demo dashboard for [DataDog](https://www.datadoghq.com/) [ecommerce-workshop](https://github.com/DataDog/ecommerce-workshop)\n\nSources : https://github.com/jnahelou/datadog-demo\n\n### Including:\n- System and business metrics\n- APM, APM monitors\n- RUM\n- SLOs\n\n### Require\n- GKE cluster with dataplane v2\n- Cilium integration\n- kube_stats_metrics\n- tags extraction\n- Custom log parser\n- APM retention policy","background_color":"gray","font_size":"12","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":3,"width":3,"height":4}},{"id":1021900173376448,"definition":{"title":"Traffic per version","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"response_format":"timeseries","queries":[{"query":"sum:trace.rack.request.hits{*} by {version}.as_rate()","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}]},"layout":{"x":3,"y":3,"width":3,"height":2}},{"id":5162687484449750,"definition":{"title":"Non 2xx status change","title_size":"16","title_align":"left","type":"change","requests":[{"formulas":[{"formula":"hour_before(query1)"},{"formula":"query1"}],"show_present":true,"increase_good":false,"response_format":"scalar","queries":[{"query":"sum:trace.rack.request.hits.by_http_status{!http.status_class:2xx} by {http.status_class}.as_count()","data_source":"metrics","name":"query1","aggregator":"sum"}]}]},"layout":{"x":3,"y":5,"width":3,"height":2}},{"id":1417510696401154,"definition":{"title":"","title_size":"16","title_align":"left","type":"log_stream","indexes":[],"query":"status:error  -service:(cluster-agent OR proxy-agent OR agent OR cilium)","sort":{"column":"time","order":"desc"},"columns":["service","pod_name"],"show_date_column":true,"show_message_column":true,"message_display":"expanded-md"},"layout":{"x":0,"y":0,"width":12,"height":3,"is_column_break":true}},{"id":2000418431479632,"definition":{"title":"Infrastructure","type":"group","background_color":"white","show_title":true,"layout_type":"ordered","widgets":[{"id":4905440135683532,"definition":{"title":"Available CPU","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query2 - (query1 / 1000000000)"}],"conditional_formats":[{"comparator":"<=","palette":"white_on_yellow","value":3},{"comparator":">","palette":"white_on_green","value":3}],"response_format":"scalar","queries":[{"query":"sum:kubernetes_state.node.cpu_capacity{$cluster-name}","data_source":"metrics","name":"query2","aggregator":"avg"},{"query":"sum:kubernetes.cpu.usage.total{$cluster-name}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":false,"custom_unit":"core","precision":2,"timeseries_background":{"type":"bars","yaxis":{"include_zero":false}}},"layout":{"x":0,"y":0,"width":1,"height":1}},{"id":8607196750509994,"definition":{"title":"Pods count","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"conditional_formats":[{"comparator":">=","palette":"white_on_green","value":10},{"comparator":"<","palette":"white_on_yellow","value":10},{"comparator":">=","palette":"white_on_yellow","value":250}],"response_format":"scalar","queries":[{"query":"sum:kubernetes.pods.running{$cluster-name,$app}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":1,"y":0,"width":1,"height":1}},{"id":5776978196106516,"definition":{"title":"","title_size":"16","title_align":"left","show_legend":true,"type":"heatmap","requests":[{"q":"sum:kubernetes.cpu.usage.total{$app,$cluster-name} by {pod_name}","style":{"palette":"dog_classic"}}]},"layout":{"x":3,"y":0,"width":4,"height":3}},{"id":5976784777349130,"definition":{"title":"","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"response_format":"timeseries","queries":[{"query":"avg:system.cpu.idle{$cluster-name} by {host}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":7,"y":0,"width":4,"height":3}},{"id":1106613909714738,"definition":{"title":"Available memory","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query2"}],"conditional_formats":[{"comparator":">=","palette":"white_on_green","value":6},{"comparator":"<","palette":"white_on_yellow","value":6},{"comparator":"<=","palette":"white_on_red","value":2}],"response_format":"scalar","queries":[{"query":"sum:kubernetes.memory.usage{$cluster-name}","data_source":"metrics","name":"query2","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":0,"y":1,"width":1,"height":1}},{"id":30650361801432,"definition":{"title":"Pods restart","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"conditional_formats":[{"comparator":"<","palette":"white_on_green","value":1},{"comparator":">=","palette":"white_on_yellow","value":1}],"response_format":"scalar","queries":[{"query":"sum:kubernetes.containers.restarts{$cluster-name,$app}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2,"timeseries_background":{"type":"bars"}},"layout":{"x":1,"y":1,"width":1,"height":1}},{"id":7065212280368832,"definition":{"title":"CPU-intensive pods","title_size":"16","title_align":"left","type":"toplist","requests":[{"formulas":[{"formula":"query1","limit":{"count":500,"order":"desc"}}],"response_format":"scalar","queries":[{"query":"sum:kubernetes.cpu.usage.total{$cluster-name,$app} by {pod_name}","data_source":"metrics","name":"query1","aggregator":"avg"}]}]},"layout":{"x":0,"y":2,"width":3,"height":2}},{"id":609913983971646,"definition":{"title":"","title_size":"16","title_align":"left","show_legend":true,"type":"heatmap","requests":[{"q":"sum:kubernetes.memory.usage{$cluster-name,$app} by {pod_name}","style":{"palette":"dog_classic"}}]},"layout":{"x":3,"y":3,"width":4,"height":3}},{"id":1062691254947126,"definition":{"title":"","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"vertical","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"response_format":"timeseries","queries":[{"query":"avg:system.mem.pct_usable{*} by {host}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":7,"y":3,"width":4,"height":3}},{"id":5909559104053020,"definition":{"title":"Memory-intensive pods","title_size":"16","title_align":"left","type":"toplist","requests":[{"formulas":[{"formula":"query1","limit":{"count":500,"order":"desc"}}],"response_format":"scalar","queries":[{"query":"sum:kubernetes.memory.usage{$cluster-name,$app} by {pod_name}","data_source":"metrics","name":"query1","aggregator":"avg"}]}]},"layout":{"x":0,"y":4,"width":3,"height":2}}]},"layout":{"x":0,"y":10,"width":12,"height":7}}],"template_variables":[{"name":"cluster-name","default":"*","prefix":"cluster-name","available_values":[]},{"name":"app","default":"*","prefix":"app","available_values":[]}],"layout_type":"ordered","is_read_only":false,"notify_list":[],"reflow_type":"fixed","id":"rb9-6z2-cx4"}